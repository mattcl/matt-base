---
resources:
  - name: repo
    type: git
    source:
      uri: https://github.com/mattcl/matt-base.git
      branch: master

jobs:
  - name: converge
    public: false
    serial: true
    build_logs_to_retain: 100
    plan:
      - get: repo
        trigger: true
      - aggregate:
        - task: converge-1404
          file: repo/ci/converge.yml
          params:
            KITCHEN_DOCKER_SOCKET: {{docker-socket}}
            suite: full-ubuntu-1404
        - task: converge-1604
          file: repo/ci/converge.yml
          params:
            KITCHEN_DOCKER_SOCKET: {{docker-socket}}
            suite: full-ubuntu-1604

  - name: package
    public: false
    serial: true
    build_logs_to_retain: 100
    plan:
      - get: repo
        trigger: true
        passed: [converge]
      - task: berks-package
        file: repo/ci/package.yml
